<h1 class="page-title">Members</h1> <br>

<div class="partners-container">
  <!-- Filters Sidebar -->
  <div class="filters-sidebar">
    <form method="get" action="<%= associated_partners_index_path %>" class="filters-form" onsubmit="updateHiddenInputs(event)">
      <!-- Role Filter -->
      <div class="filter-section">
        <h3 class="filter-title">Role</h3>
        <div class="filter-options">
          <% @roles.each do |role| %>
            <div class="filter-option">
              <input type="checkbox" 
                     id="role_<%= role %>" 
                     name="role_checkbox"
                     value="<%= role %>"
                     <% if @selected_roles.include?(role) %>checked<% end %>
                     class="role-checkbox" />
              <label for="role_<%= role %>">
                <%= role.capitalize %>
              </label>
            </div>
          <% end %>
        </div>
      </div>

      <!-- Country Filter -->
      <div class="filter-section">
        <h3 class="filter-title">Country</h3>
        <div class="filter-options">
          <% @countries.each do |country| %>
            <div class="filter-option">
              <input type="checkbox" 
                     id="country_<%= country.downcase.gsub(' ', '_') %>" 
                     name="country_checkbox"
                     value="<%= country %>"
                     <% if @selected_countries.include?(country) %>checked<% end %>
                     class="country-checkbox" />
              <label for="country_<%= country.downcase.gsub(' ', '_') %>">
                <%= country %>
              </label>
            </div>
          <% end %>
        </div>
      </div>

      <div class="filter-actions">
        <button type="submit" class="btn btn-apply">Apply Filters</button>
        <a href="<%= associated_partners_index_path %>" class="btn btn-reset">Reset Filters</a>
      </div>

      <!-- Hidden input to store selected values -->
      <input type="hidden" id="selected_roles" name="roles" value="<%= @selected_roles.join(',') %>" />
      <input type="hidden" id="selected_countries" name="countries" value="<%= @selected_countries.join(',') %>" />
    </form>
  </div>

  <!-- Main Content -->
  <div class="partners-content">
    <div class="partner-list">
      <% @users.each do |user| %>
        <%= link_to user_path(user) do %>
          <div class="partner-card">
            <div class="avatar">
              <% if user.avatar&.attached? %>
                <%= image_tag(
                      url_for(user.avatar.variant(resize_to_fill: [60, 60])),
                      style: "width: 60px; height: 60px; border-radius: 50%; object-fit: cover;",
                    ) %>
              <% else %>
                <%= image_tag("avatar.png", alt: user.name, class: "avatar-img") %>
              <% end %>
            </div>
            <div class="details">
              <div class="name"><strong><%= user.name.presence || "No Name" %></strong>
                <% if user.role.present? %>
                  <small> (<%= user.role %>) </small>
                <% end %>
              </div>
              
              <div class="username"><%= user.username.presence || "" %></div>
              <% if user.country.present? %>
                <div class="country"><%= user.country %></div>
              <% end %>
              <% if user_signed_in? %>
                <div class="email"><%= user.email %></div>
              <% end %>
            </div>
          </div>
        <% end %>
      <% end %>
    </div>

    <!-- Pagination -->
    <div class="pagination-wrapper">
      <%= paginate @users, param_name: :page %>
    </div>
  </div>
</div>


<style>
  .page-title {
    font-size: 2rem;
    text-align: left;
    margin: 1rem auto;
    padding: 0 1rem;
    word-wrap: break-word;
    max-width: 1400px;
  }

  .partners-container {
    display: flex;
    gap: 2rem;
    padding: 0 1rem;
    max-width: 1400px;
    margin: 0 auto;
  }

  /* Sidebar Styles */
  .filters-sidebar {
    flex: 0 0 250px;
    background: #f8f9fa;
    border-radius: 8px;
    padding: 1.5rem;
    height: fit-content;
    position: sticky;
    top: 20px;
  }

  .filters-form {
    display: flex;
    flex-direction: column;
    gap: 2rem;
  }

  .filter-section {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .filter-title {
    font-size: 1.0rem;
    font-weight: 700;
    margin: 0;
    color: #333;
  }

  .filter-options {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
  }

  .filter-option {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .filter-option input[type="checkbox"] {
    cursor: pointer;
    width: 18px;
    height: 18px;
  }

  .filter-option label {
    cursor: pointer;
    font-size: 0.95rem;
    color: #555;
    margin: 0;
    flex: 1;
  }

  .filter-option input[type="checkbox"]:checked + label {
    font-weight: 500;
    color: #333;
  }

  .filter-actions {
    display: flex;
    gap: 0.5rem;
    padding-top: 1rem;
    border-top: 1px solid #e0e0e0;
  }

  .btn {
    padding: 0.5rem 1rem;
    border: none;
    border-radius: 4px;
    font-size: 0.9rem;
    cursor: pointer;
    text-decoration: none;
    display: inline-block;
    text-align: center;
    transition: all 0.3s ease;
  }

  .btn-apply {
    flex: 1;
    background-color: #0066cc;
    color: white;
  }

  .btn-apply:hover {
    background-color: #0052a3;
  }

  .btn-reset {
    flex: 1;
    background-color: #e0e0e0;
    color: #333;
  }

  .btn-reset:hover {
    background-color: #d0d0d0;
  }

  /* Main Content Styles */
  .partners-content {
    flex: 1;
    min-width: 0;
  }

  .partner-list {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    width: 100%;
  }

  .partner-card {
    display: flex;
    align-items: center;
    border: 1px solid #ddd;
    border-radius: 8px;
    padding: 1rem;
    background-color: #fff;
    box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    width: 100%;
    transition: all 0.3s ease;
  }

  .partner-card:hover {
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  }

  .avatar {
    flex-shrink: 0;
  }

  .avatar-img {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    object-fit: cover;
  }

  .details {
    margin-left: 1rem;
    display: flex;
    flex-direction: column;
  }

  .details .name {
    font-weight: bold;
    font-size: 1.5rem;
  }

  .details .username,
  .details .email,
  .details .country {
    font-size: 0.9rem;
    color: #666;
  }

  .details .official-position {
    font-size: 0.9rem;
    color: #444;
    margin-top: 2px;
  }

  /* Pagination Styles */
  .pagination-wrapper {
    display: flex;
    justify-content: center;
    margin-top: 2rem;
    padding-top: 2rem;
    border-top: 1px solid #e0e0e0;
  }

  /* Responsive Design */
  @media (max-width: 768px) {
    .partners-container {
      flex-direction: column;
      gap: 1.5rem;
    }

    .filters-sidebar {
      flex: 1 1 100%;
      position: static;
    }

    .partners-content {
      flex: 1 1 100%;
    }
  }
</style>

<script>
  function updateHiddenInputs(event) {
    const roleCheckboxes = document.querySelectorAll('.role-checkbox');
    const countryCheckboxes = document.querySelectorAll('.country-checkbox');
    const selectedRolesInput = document.getElementById('selected_roles');
    const selectedCountriesInput = document.getElementById('selected_countries');

    const selectedRoles = Array.from(roleCheckboxes)
      .filter(checkbox => checkbox.checked)
      .map(checkbox => checkbox.value)
      .join(',');
    
    const selectedCountries = Array.from(countryCheckboxes)
      .filter(checkbox => checkbox.checked)
      .map(checkbox => checkbox.value)
      .join(',');

    selectedRolesInput.value = selectedRoles;
    selectedCountriesInput.value = selectedCountries;
  }
</script>
